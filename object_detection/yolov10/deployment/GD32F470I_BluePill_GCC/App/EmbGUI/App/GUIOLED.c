/*********************************************************************************************************
* 模块名称：GUIOLED.c
* 摘    要：OLED显示模块
* 当前版本：1.0.0
* 作    者：Leyutek(COPYRIGHT 2018 - 2021 Leyutek. All rights reserved.)
* 完成日期：2021年07月01日
* 内    容：
* 注    意：
**********************************************************************************************************
* 取代版本：
* 作    者：
* 完成日期：
* 修改内容：
* 修改文件：
*********************************************************************************************************/

/*********************************************************************************************************
*                                              包含头文件
*********************************************************************************************************/
#include "GUIOLED.h"
#include "TLILCD.h"
#include "GUIPlatform.h"
#include "GraphWidget.h"
#include "BMP.h"
#include "Common.h"
#include "GD25QXX.h"
#include "OLED.h"
#include "RTC.h"
#include "stdio.h"

/*********************************************************************************************************
*                                              宏定义
*********************************************************************************************************/

/*********************************************************************************************************
*                                              枚举结构体定义
*********************************************************************************************************/

/*********************************************************************************************************
*                                              内部变量
*********************************************************************************************************/

/*********************************************************************************************************
*                                              内部函数声明
*********************************************************************************************************/

/*********************************************************************************************************
*                                              内部函数实现
*********************************************************************************************************/

/*********************************************************************************************************
*                                              API函数实现
*********************************************************************************************************/
/*********************************************************************************************************
* 函数名称：CreateGUIOLED
* 函数功能：创建OLED显示模块
* 输入参数：void
* 输出参数：void
* 返 回 值：void
* 创建日期：2021年07月01日
* 注    意：
*********************************************************************************************************/
void CreateGUIOLED(void)
{
  //LCD横屏显示
  LCDDisplayDir(LCD_SCREEN_HORIZONTAL);

  //绘制背景
  DisPlayBMPByIPA(0, 0, OLED_BACKGROUND_DIR);

  //初始化OLED
  InitOLED();
}

/*********************************************************************************************************
* 函数名称：DeleteGUIOLED
* 函数功能：删除OLED显示模块
* 输入参数：void
* 输出参数：void
* 返 回 值：void
* 创建日期：2021年07月01日
* 注    意：
*********************************************************************************************************/
void DeleteGUIOLED(void)
{
  //清屏
  OLEDClear();
  
  //重新初始化SPI Flash
  InitGD25QXX();
}

/*********************************************************************************************************
* 函数名称：GUIOLEDPoll
* 函数功能：OLED轮询任务
* 输入参数：void
* 输出参数：void
* 返 回 值：void
* 创建日期：2021年07月01日
* 注    意：
*********************************************************************************************************/
void GUIOLEDPoll(void)
{
  static u64 s_iLastTime = 0;
  u32 hour, min, sec;
  u32 year, mon, date, week;
  char string[32];

  if((GUIGetSysTime() - s_iLastTime) > 500)
  {
    s_iLastTime = GUIGetSysTime();

    //获取时间
    RTCGetTime(&hour, &min, &sec);
    RTCGetDate(&year, &mon, &date, &week);

    //显示
    OLEDShowString(12, 0, "GD32F450Board");
    OLEDShowString(24, 48, "OLED IS OK");
    sprintf(string, "%04d-%02d-%02d", year, mon, date);
    OLEDShowString(24, 16, string);
    sprintf(string, "%02d:%02d:%02d", hour, min, sec);
    OLEDShowString(32, 32, string);

    //刷新显示
    OLEDRefreshGRAM();
  }
}
